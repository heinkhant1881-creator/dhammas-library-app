// --- Dhamma Data (V2.0: Updated with detailed text and more topics) ---
const dhammaTopics = [
    { 
        title: 'မဂ္ဂင်ရှစ်ပါး (Noble Eightfold Path)', 
        author: 'ဗုဒ္ဓဓမ္မ', 
        category: 'Basic', 
        year: 'N/A', 
        text: 
            `ပဋိပဒါ ခေါ် မဂ္ဂင်ရှစ်ပါးသည် ဒုက္ခချုပ်ငြိမ်းရာ နိဗ္ဗာန်သို့ ရောက်ကြောင်း လမ်းကောင်း ဖြစ်သည်။

I. ပညာမဂ္ဂင် (Wisdom Factors)
၁။ သမ္မာဒိဋ္ဌိ (Right View) - (အသေးစိတ်) လောကီ သမ္မာဒိဋ္ဌိ၊ လောကုတ္တရာ သမ္မာဒိဋ္ဌိ။ ဒုက္ခ၊ ဒုက္ခသမုဒယ၊ ဒုက္ခနိရောဓ၊ ဒုက္ခနိရောဓဂါမိနီ ပဋိပဒါ ဟူသော အရိယသစ္စာတရား လေးပါးကို သိမြင်ခြင်း။ ကံ၊ ကံ၏ အကျိုးကို မှန်ကန်စွာ ယုံကြည်သိမြင်ခြင်း။
၂။ သမ္မာသင်္ကပ္ပ (Right Thought) - (အသေးစိတ်) နိဗ္ဗာန်သို့ ဦးတည်သော နေက္ခမ္မ (ထွက်မြောက်လိုစိတ်)၊ အဗျာပါဒ (မေတ္တာ၊ စေတနာ)၊ အဝိဟိံသာ (မညှင်းဆဲလိုစိတ်၊ ကရုဏာ) တို့ဖြင့် ကြံစည်ခြင်း။

II. သီလမဂ္ဂင် (Moral Factors)
၃။ သမ္မာဝါစာ (Right Speech) - (အသေးစိတ်) မုသာဝါဒ (လိမ်ပြောခြင်း)၊ ပိသုဏာဝါစာ (ကုန်းတိုက်ခြင်း)၊ ဖရုသာဝါစာ (ကြမ်းတမ်းသောစကား)၊ သမ္ဖပ္ပလာပ (အနှစ်မရှိသော စကား) တို့မှ ရှောင်ကြဉ်ခြင်း။
၄။ သမ္မာကမ္မန္တ (Right Action) - (အသေးစိတ်) ပါဏာတိပါတ (အသက်သတ်ခြင်း)၊ အဒိန္နာဒါန (သူ့ပစ္စည်း ခိုးယူခြင်း)၊ ကာမေသုမိစ္ဆာစာရ (ကာမဂုဏ်၌ မှားယွင်းစွာ ကျင့်ခြင်း) တို့မှ ရှောင်ကြဉ်ခြင်း။
၅။ သမ္မာအာဇီဝ (Right Livelihood) - (အသေးစိတ်) လူမိုက်နှင့် အရိယာတို့အတွက် အကုသိုလ်ဖြစ်စေသော အသက်မွေးဝမ်းကျောင်းမှု (ဥပမာ-လက်နက်ရောင်းခြင်း၊ အဆိပ်ရောင်းခြင်း၊ လူကုန်ကူးခြင်း စသည်) မှ ရှောင်ကြဉ်ခြင်း။

III. သမာဓိမဂ္ဂင် (Concentration Factors)
၆။ သမ္မာဝါယာမ (Right Effort) - (အသေးစိတ်) သံဝရ (မဖြစ်သေးသောအကုသိုလ်ကို မဖြစ်အောင်စောင့်စည်းခြင်း)၊ ပဟာန (ဖြစ်ပြီးသောအကုသိုလ်ကို ပယ်ခြင်း)၊ ဘာဝနာ (မဖြစ်သေးသောကုသိုလ်ကို ဖြစ်စေခြင်း)၊ အနုရက္ခနာ (ဖြစ်ပြီးသောကုသိုလ်ကို တိုးပွားစေခြင်း) ဟူသော လုံ့လလေးပါး။
၇။ သမ္မာသတိ (Right Mindfulness) - (အသေးစိတ်) ကာယာနုပဿနာ (ခန္ဓာကိုယ်၌ စွဲလမ်းမှုရှုခြင်း)၊ ဝေဒနာနုပဿနာ (ခံစားမှု၌ ရှုခြင်း)၊ စိတ္တာနုပဿနာ (စိတ်၌ ရှုခြင်း)၊ ဓမ္မာနုပဿနာ (ဓမ္မ၌ ရှုခြင်း) ဟူသော သတိပဋ္ဌာန်တရားလေးပါးဖြင့် ရှုမှတ်ခြင်း။
၈။ သမ္မာသမာဓိ (Right Concentration) - (အသေးစိတ်) ကာမဂုဏ်တို့မှ ကင်းဆိတ်၍ ဖြစ်ပေါ်လာသော ပထမ၊ ဒုတိယ၊ တတိယ၊ စတုတ္ထ ဈာန်တရားများဖြင့် စိတ်ကို တည်ငြိမ်စေခြင်း။
        `
    },
    { 
        title: 'ဒါန၊ သီလ၊ ဘာဝနာ (Generosity, Virtue, Meditation)', 
        author: 'ဗုဒ္ဓဓမ္မ', 
        category: 'Basic', 
        year: 'N/A', 
        text: 
            `မြတ်ဗုဒ္ဓ၏ အခြေခံ ကောင်းမှုကုသိုလ်သုံးပါး (ပုညကိရိယဝတ္ထု သုံးပါး) ကို အသေးစိတ် လေ့လာခြင်း။

            ၁။ ဒါန (ပေးလှူခြင်း)
            * အဓိပ္ပာယ်- စေတနာရှေ့ထား၍ မိမိပိုင်ဆိုင်သော ပစ္စည်းဥစ္စာများကို လိုအပ်သူအား စွန့်ကြဲပေးကမ်းခြင်း။
            * အကျိုး- လောဘနှင့် တွယ်တာမှုကို ပယ်သတ်ခြင်း၊ လာဘ်လာဘနှင့် ချမ်းသာကို ရရှိခြင်း။
            * အလှူခံပုဂ္ဂိုလ်ကို ရွေးချယ်၍ လှူဒါန်းခြင်း၊ စေတနာသုံးတန် ပြည့်စုံအောင် လှူဒါန်းခြင်း၏ အကျိုးတရားများ။

            ၂။ သီလ (ကိုယ်ကျင့်သီလ)
            * အဓိပ္ပာယ်- ကိုယ်၊ နှုတ်၊ စိတ်တို့ကို စောင့်စည်းထိန်းသိမ်းခြင်း၊ ကိုယ်နှင့် နှုတ်ဖြင့် ပြုလုပ်သော မကောင်းမှုမှ ရှောင်ကြဉ်ခြင်း။
            * အကျိုး- လုံခြုံမှု၊ ချမ်းသာမှု၊ ဘေးကင်းမှု ရရှိခြင်း။
            * အခြေခံ ငါးပါးသီလ၏ အသေးစိတ် အကျိုးကျေးဇူးများ (ဥပမာ- မုသာဝါဒမှ ရှောင်ခြင်းကြောင့် သစ္စာတရားကို ပြောဆိုနိုင်ခြင်း)။ ရှစ်ပါးသီလနှင့် ဆယ်ပါးသီလ၏ လေ့လာမှတ်သားဖွယ်များ။

            ၃။ ဘာဝနာ (ပွားများခြင်း)
            * အဓိပ္ပာယ်- စိတ်ကို ကောင်းမွန်အောင်၊ ဉာဏ်ပညာ တိုးတက်အောင် ပြုပြင်မွမ်းမံခြင်း။
            * အမျိုးအစား-
                က. သမထဘာဝနာ (Samatha) - စိတ်ငြိမ်အောင် ပွားများခြင်း (ကသိုဏ်းဆယ်ပါး၊ အသုဘ ဆယ်ပါး စသည်)။
                ခ. ဝိပဿနာဘာဝနာ (Vipassana) - ဖြစ်ပျက်ခြင်း သဘောကို သိမြင်ရန် ပွားများခြင်း (သတိပဋ္ဌာန် လေးပါးဖြင့် ရှုမှတ်ခြင်း)။
            * အကျိုး- ကိလေသာမှ ကင်းဝေးခြင်း၊ ပညာဉာဏ် ဖွံ့ဖြိုးတိုးတက်ခြင်း၊ နိဗ္ဗာန်သို့ ဦးတည်ခြင်း။
            `
    },
    { 
        title: 'အနတ္တလက္ခဏာသုတ် (Anattalakkhaṇa Sutta)', 
        author: 'မြတ်စွာဘုရား', 
        category: 'Sutta', 
        year: 'N/A', 
        text: 
            `ခန္ဓာငါးပါး အနတ္တတရားကို ဟောကြားတော်မူခြင်း (ပဉ္စဝဂ္ဂီ ငါးဦးကို ပထမဆုံး ဟောကြားတော်မူသည့် တရားတော်များထဲမှ တစ်ခု)။

            ရူပံ ဘိက္ခဝေ အနတ္တာ။ (ချစ်သားတို့၊ ရုပ်သည် အတ္တမဟုတ်)။
            ဝေဒနာ အနတ္တာ။ (ဝေဒနာသည် အတ္တမဟုတ်)။
            သညာ အနတ္တာ။ (သညာသည် အတ္တမဟုတ်)။
            သင်္ခါရာ အနတ္တာ။ (သင်္ခါရတို့သည် အတ္တမဟုတ်)။
            ဝိညာဏံ အနတ္တာ။ (ဝိညာဉ်သည် အတ္တမဟုတ်)။
            
            ထိုခန္ဓာငါးပါးတို့သည် အနိစ္စ၊ ဒုက္ခ၊ အနတ္တ ဖြစ်ခြင်း အကြောင်းရင်း အသေးစိတ်:
            ၁။ အနိစ္စ (မမြဲခြင်း) - ခန္ဓာငါးပါးသည် အမြဲတမ်း ပြောင်းလဲ ပျက်စီးနေသောကြောင့် မမြဲပါ။
            ၂။ ဒုက္ခ (ဆင်းရဲခြင်း) - ဆင်းရဲဒုက္ခတို့နှင့်သာ အမြဲတမ်း တွေ့ကြုံနေရသောကြောင့် ဆင်းရဲခြင်း သဘောရှိသည်။
            ၃။ အနတ္တ (အတ္တမဟုတ်ခြင်း) - ငါ့ကိုယ်၊ ငါပိုင်ဆိုင်သည်၊ ငါ၏ အစိုးရမှုဟု မသတ်မှတ်နိုင်၊ အလိုအတိုင်း မဖြစ်စေနိုင်ဘဲ ပျက်စီးသွားသောကြောင့် အတ္တမဟုတ်ပါ။

            ဤတရားတော်ကို နာကြားရသော ပဉ္စဝဂ္ဂီ ငါးဦးတို့သည် ရဟန္တာ ဖြစ်တော်မူကြသည်။`
    },
    { 
        title: 'ပဋိစ္စသမုပ္ပါဒ် (Dependent Origination)', 
        author: 'မဟာစည် ဆရာတော်', 
        category: 'Abhidhamma', 
        year: 1965, 
        text: 
            `ပဋိစ္စသမုပ္ပါဒ်ဆိုသည်မှာ အကြောင်းအကျိုး ဆက်စပ်မှု နိယာမဖြစ်သည်။ ဤတရားတော်ကို သိမြင်ခြင်းဖြင့် ဗုဒ္ဓဘာသာဝင်တို့ သံသရာမှ ထွက်မြောက်ရာ လမ်းကို သိမြင်နိုင်သည်။

            ၁။ အဝိဇ္ဇာပစ္စယာ သင်္ခါရာ (မသိမှုကြောင့် ပြုပြင်စီရင်မှုဖြစ်)
                * အဝိဇ္ဇာ (အမှန်ကို မသိခြင်း)
                * သင်္ခါရ (ကုသိုလ်၊ အကုသိုလ် ပြုလုပ်မှု)
            ၂။ သင်္ခါရပစ္စယာ ဝိညာဏံ (သင်္ခါရကြောင့် ဝိညာဉ်ဖြစ်)
            ၃။ ဝိညာဏပစ္စယာ နာမရူပံ (ဝိညာဉ်ကြောင့် နာမ်ရုပ်ဖြစ်)
            ၄။ နာမရူပပစ္စယာ သဠာယတနံ (နာမ်ရုပ်ကြောင့် အာရုံခြောက်ပါးဖြစ်)
            ၅။ သဠာယတနပစ္စယာ ဖေဿာ (အာရုံခြောက်ပါးကြောင့် တွေ့ထိမှုဖြစ်)
            ၆။ ဖဿပစ္စယာ ဝေဒနာ (တွေ့ထိမှုကြောင့် ခံစားမှုဖြစ်)
            ၇။ ဝေဒနာပစ္စယာ တဏှာ (ခံစားမှုကြောင့် တပ်မက်မှုဖြစ်)
            ၈။ တဏှာပစ္စယာ ဥပါဒါနံ (တပ်မက်မှုကြောင့် စွဲလမ်းမှုဖြစ်)
            ၉။ ဥပါဒါနပစ္စယာ ဘဝေါ (စွဲလမ်းမှုကြောင့် ကံဘဝဖြစ်)
            ၁၀။ ဘဝပစ္စယာ ဇာတိ (ကံဘဝကြောင့် ပဋိသန္ဓေနေရခြင်းဖြစ်)
            ၁၁။ ဇာတိပစ္စယာ ဇရာမရဏံ (ဇာတိကြောင့် အိုခြင်း၊ သေခြင်းဖြစ်)

            ဤအင်္ဂါ ၁၂ ပါးတို့သည် ကွင်းဆက်သဖွယ် ဆက်စပ်လျက်ရှိပြီး ဒုက္ခသံသရာကို လည်ပတ်စေသည်။ ထိုကွင်းဆက်မှ လွတ်မြောက်ခြင်းသည် နိဗ္ဗာန်သို့ ရောက်ရှိခြင်းပင် ဖြစ်သည်။`
    },
    {
        title: 'နိဗ္ဗာန်နှင့် သံသရာ (Nibbana and Samsara)',
        author: 'အရှင်ဇနကာဘိဝံသ',
        category: 'Abhidhamma',
        year: 1980,
        text: `နိဗ္ဗာန်သည် ကိလေသာတို့၏ ချုပ်ငြိမ်းရာ တရားဖြစ်သည်။ သံသရာသည် ခန္ဓာငါးပါး၏ ဖြစ်ခြင်း၊ ပျက်ခြင်း ဒုက္ခများတွင် အနိစ္စသဘောဖြင့် လည်ပတ်နေခြင်းဖြစ်သည်။ နိဗ္ဗာန်သည် သံသရာမှ ထွက်မြောက်ရာ အမြဲတည်မြဲသော တရားဖြစ်သည်။`
    },
    {
        title: 'ဗုဒ္ဓဝင် အကျဉ်းချုပ် (Short Biography of the Buddha)',
        author: 'Various Sources',
        category: 'History',
        year: 'N/A',
        text: `ဘုရားအလောင်းတော် သိဒ္ဓတ္ထမင်းသား ဖွားတော်မူခြင်းမှစ၍ လေးပြင်ကြည့်ခြင်း၊ တောထွက်တော်မူခြင်း၊ ခြောက်နှစ် ဒုက္ကရစရိယာကျင့်တော်မူခြင်း၊ ဗောဓိပင်အောက်တွင် အသိဉာဏ်ရရှိကာ ဘုရားအဖြစ်သို့ ရောက်တော်မူခြင်းနှင့် ပရိနိဗ္ဗာန် ဝင်စံတော်မူခြင်းတို့ အသေးစိတ် ပါဝင်သည်။`
    }
];

const categories = ['Basic', 'Sutta', 'Abhidhamma', 'History', 'Resources']; 

// --- External Resources Data (Links are increased) ---
const externalResources = [
    { name: 'ဓမ္မဒါနစာပေ (Dhamma Dana)', link: 'https://dhammadana.info/', description: 'စာအုပ်များ အခမဲ့ Download ရယူရန်' },
    { name: 'Tipitaka Pali Canon', link: 'https://www.tipitaka.org/', description: 'မူရင်း ပိဋကတ်တော်များ (မြန်မာအစိုးရ) လေ့လာရန်' },
    { name: 'SuttaCentral (Pali/English)', link: 'https://suttacentral.net/', description: 'ပါဠိတော်များနှင့် အင်္ဂလိပ်ပြန်ဆိုချက်များ' },
    { name: 'MoeGok Web (မိုးကုတ်)', link: 'http://www.moegok.net/', description: 'မိုးကုတ်တရားတော်များ နာယူရန်' },
    { name: 'Dhamma Talks by Sayadaw U Janaka', link: 'http://www.satipatthana.info/', description: 'ဝိပဿနာ ကျင့်စဉ်များနှင့် တရားတော်များ လေ့လာရန်' },
    { name: 'Dhammakami Sayadaw', link: 'https://dhammakami.com/', description: 'ဓမ္မကာမီ ဆရာတော်၏ တရားစာများ' },
    { name: 'Ashin Thittila Dhamma Books', link: 'https://www.thittila.org/', description: 'အရှင်သီလာ၏ စာအုပ်များ' }
];

// --- DOM Elements (Existing) ---
const appFrame = document.getElementById('appFrame');
const mainContent = document.getElementById('mainContent');
const navButtons = document.querySelectorAll('.nav-btn');
const detailModal = document.getElementById('detailModal');
const detailTitle = document.getElementById('detailTitle');
const detailText = document.getElementById('detailText');
const settingsModal = document.getElementById('settingsModal');
const darkModeToggle = document.getElementById('darkModeToggle');
const languageSelect = document.getElementById('languageSelect');
const fontStyleSelect = document.getElementById('fontStyleSelect');

// --- New About Modal Elements ---
let aboutModal; 
let aboutContent;

// --- State Variables (Existing) ---
let currentLanguage = 'myanmar';


// --- Core App Rendering Functions ---

function renderHomePage(books) {
    mainContent.innerHTML = `
        <div class="search-container">
            <input type="text" id="searchInput" placeholder="${currentLanguage === 'myanmar' ? 'ဓမ္မခေါင်းစဉ်များ ရှာဖွေပါ...' : 'Search Dhamma Topics or Suttas...'}" oninput="filterBooks()">
            <i class="fas fa-search search-icon"></i>
        </div>
        <div id="bookList" class="book-list"></div>
    `;
    renderBookList(books);
    
    // Re-attach filterBooks function to the new input element
    const newSearchInput = document.getElementById('searchInput');
    if (newSearchInput) {
        newSearchInput.addEventListener('input', filterBooks);
    }
}

function renderBookList(books) {
    const bookListEl = document.getElementById('bookList');
    if (!bookListEl) return;
    
    bookListEl.innerHTML = ''; 
    
    if (books.length === 0) {
        bookListEl.innerHTML = `<p style="text-align: center; color: #777; padding: 20px;">${currentLanguage === 'myanmar' ? 'ရှာဖွေသော ဓမ္မခေါင်းစဉ် မတွေ့ပါ' : 'No Dhamma topics found'}</p>`;
        return;
    }

    books.forEach(book => {
        const item = document.createElement('div');
        item.className = 'book-item';
        item.innerHTML = `
            <h3>${book.title}</h3>
            <p style="font-size: 0.85em; color: #999;">${currentLanguage === 'myanmar' ? 'ကဏ္ဍ' : 'Category'}: ${book.category} | ${book.author}</p>
            
            <div class="book-actions" style="margin-top: 10px; display: flex; gap: 10px;">
                <button class="read-btn" style="background-color: var(--danger-color);">${currentLanguage === 'myanmar' ? 'အသေးစိတ် ဖတ်ရန်' : 'Read Detail'}</button>
                
                <button class="save-btn" style="background-color: #333; color: white; border: none; padding: 8px 15px; border-radius: 20px; font-size: 0.8em; cursor: pointer;">
                    <i class="fas fa-save"></i> ${currentLanguage === 'myanmar' ? 'Offline Save' : 'Save'}
                </button>
            </div>
        `;
        
        // Event Listener for Read Detail
        item.querySelector('.read-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            showDetailModal(book.title, book.text);
        });

        // Event Listener for Offline Save (Simulation)
        item.querySelector('.save-btn').addEventListener('click', (e) => {
            e.stopPropagation();
            alert(`${book.title} ${currentLanguage === 'myanmar' ? 'ကို Offline ဖတ်ရှုနိုင်ရန် သိမ်းဆည်းထားပါသည်။ (PWA Cache)' : 'Saved for offline reading. (PWA Cache)'}`);
            // *Note: In a real PWA, you would add logic here to cache the book's data*
        });

        // Event Listener for Card click (same as detail)
        item.addEventListener('click', () => showDetailModal(book.title, book.text));

        bookListEl.appendChild(item);
    });
}


function renderCategoriesPage() {
    mainContent.innerHTML = `<h2 style="color: var(--primary-color); margin-top: 0;">${currentLanguage === 'myanmar' ? 'ဓမ္မကဏ္ဍများ' : 'Dhamma Categories'}</h2>`;
    
    categories.forEach(cat => {
        const isResource = cat === 'Resources';
        
        const card = document.createElement('div');
        card.className = 'category-card';
        card.innerHTML = `
            <h3><i class="fas fa-folder"></i> ${cat}</h3>
            ${isResource 
                ? `<p style="color: #666; font-size: 0.9em;">${currentLanguage === 'myanmar' ? 'အွန်လိုင်း လေ့လာစရာများ' : 'Online Learning Resources'}</p>`
                : `<p style="color: #666; font-size: 0.9em;">${dhammaTopics.filter(t => t.category === cat).length} ${currentLanguage === 'myanmar' ? 'ပုဒ်' : 'Topics'}</p>`
            }
        `;
        card.addEventListener('click', () => {
            if (isResource) {
                // If Resources, render the resource list
                renderResourcesPage();
                setActiveNav('categories'); // Stay on categories tab
            } else {
                // Filter topics by category
                const filtered = dhammaTopics.filter(t => t.category === cat);
                setActiveNav('home');
                renderHomePage(filtered);
                // Note: Alert removed for smoother UI transition
            }
        });
        mainContent.appendChild(card);
    });
}

function renderResourcesPage() {
    mainContent.innerHTML = `<h2 style="color: var(--danger-color); margin-top: 0;">${currentLanguage === 'myanmar' ? '⭐ အွန်လိုင်း ဓမ္မရင်းမြစ်များ' : '⭐ Online Dhamma Resources'}</h2>`;
    
    externalResources.forEach(res => {
        const item = document.createElement('div');
        item.className = 'book-item'; // Reusing book-item style for consistency
        item.style.borderLeftColor = '#9E1010'; // Red accent for links
        item.innerHTML = `
            <h3>${res.name} <i class="fas fa-external-link-alt" style="font-size: 0.8em; margin-left: 5px;"></i></h3>
            <p style="color: #666;">${res.description}</p>
            <button class="read-btn" onclick="window.open('${res.link}', '_blank')">${currentLanguage === 'myanmar' ? 'ဝက်ဘ်ဆိုက် ဖွင့်ရန်' : 'Open Website'}</button>
        `;
        mainContent.appendChild(item);
    });
}


// --- Search Functionality ---
function filterBooks() {
    const searchInput = document.getElementById('searchInput');
    if (!searchInput) return; 
    
    const searchTerm = searchInput.value.toLowerCase();
    
    const filteredBooks = dhammaTopics.filter(book => {
        return book.title.toLowerCase().includes(searchTerm) || 
               book.author.toLowerCase().includes(searchTerm) ||
               book.category.toLowerCase().includes(searchTerm);
    });

    renderBookList(filteredBooks);
}

// --- Initialization (Load Saved Settings & Start App) ---
function initializeApp() {
    // Load Dark Mode setting
    if (localStorage.getItem('darkMode') === 'enabled') {
        appFrame.classList.add('dark-mode');
        darkModeToggle.checked = true;
    }
    
    // Load Language setting
    currentLanguage = localStorage.getItem('language') || 'myanmar';
    languageSelect.value = currentLanguage;

    // Load Notifications setting
    const notifStatus = localStorage.getItem('notifications') === 'ON' ? true : false;
    // Check if element exists before accessing checked property (to prevent errors)
    const notificationsToggle = document.getElementById('notificationsToggle');
    if (notificationsToggle) {
        notificationsToggle.checked = notifStatus;
    }


    // Load Font Style setting
    const savedFont = localStorage.getItem('fontStyle') || 'default';
    fontStyleSelect.value = savedFont;
    if (savedFont !== 'default') {
        appFrame.classList.add(`font-${savedFont}`);
    }

    // Start with the Home page
    renderHomePage(dhammaTopics);
    
    // V2.0: Create About Modal here, as it's needed for the settings
    createAboutModal();
}

// V2.0: About Modal Structure Creator
function createAboutModal() {
    // Create the HTML structure for the new About Modal
    aboutModal = document.createElement('div');
    aboutModal.id = 'aboutModal';
    aboutModal.className = 'modal';
    
    aboutModal.innerHTML = `
        <div class="modal-content">
            <span class="close-btn" id="closeAbout">&times;</span>
            <h2><i class="fas fa-info-circle"></i> ${currentLanguage === 'myanmar' ? 'App အကြောင်း' : 'About App'}</h2>
            
            <div id="aboutContent" style="max-height: 400px; overflow-y: auto;">
                ${getAboutText()}
            </div>
            <p style="text-align: right; margin-top: 15px; font-size: 0.8em; color: #777;">
                ${currentLanguage === 'myanmar' ? 'တည်ဆောက်သူ' : 'Developer'}: heinkhant1881-creator
            </p>
        </div>
    `;
    document.body.appendChild(aboutModal);

    // Attach close listener
    document.getElementById('closeAbout').addEventListener('click', () => closeModal(aboutModal));
}

// V2.0: Content for the About Modal
function getAboutText() {
    return `
        <h3 style="color: var(--primary-color);">${currentLanguage === 'myanmar' ? 'ဗုဒ္ဓဘာသာ လေ့လာသင့်သည့် အကြောင်း' : 'Why Study Buddhism?'}</h3>
        <p>
            ${currentLanguage === 'myanmar' ? 
            `ဗုဒ္ဓဓမ္မသည် လူ့ဘဝဒုက္ခ၏ မူရင်းအကြောင်းရင်းနှင့် ထိုဒုက္ခမှ လွတ်မြောက်ရာ လမ်းကောင်းကို ပြသပေးသော တရားဖြစ်သည်။` :
            `Buddhism shows the root cause of suffering in life and the noble path to freedom from that suffering.`}
        </p>

        <h4 style="color: var(--accent-color); margin-top: 15px;">${currentLanguage === 'myanmar' ? 'လေ့လာမှု၏ အကျိုး (၃) ပါး' : 'Three Benefits of Study'}</h4>
        <ul style="padding-left: 20px;">
            <li><strong style="color: var(--danger-color);">
                ${currentLanguage === 'myanmar' ? 'ပညာဉာဏ် တိုးတက်ခြင်း' : 'Increased Wisdom'}
            </strong>: ဓမ္မကို နာယူမှတ်သားခြင်းဖြင့် ကောင်းသော၊ မကောင်းသော အကြောင်းအကျိုးကို ခွဲခြားသိမြင်လာခြင်း။</li>
            <li><strong style="color: var(--danger-color);">
                ${currentLanguage === 'myanmar' ? 'စိတ်ငြိမ်းချမ်းမှု ရရှိခြင်း' : 'Achieving Mental Peace'}
            </strong>: လောဘ၊ ဒေါသ၊ မောဟတို့ကို လျော့ချနိုင်သောကြောင့် စိတ်ဓာတ်တည်ငြိမ် အေးချမ်းလာခြင်း။</li>
            <li><strong style="color: var(--danger-color);">
                ${currentLanguage === 'myanmar' ? 'သံသရာမှ ထွက်မြောက်ရာ လမ်းစ' : 'The Path to Liberation'}
            </strong>: မဂ္ဂင်ရှစ်ပါးကို ကျင့်ကြံခြင်းဖြင့် နိဗ္ဗာန်သို့ ဦးတည်သော အမြင်မှန်ကို ရရှိခြင်း။</li>
        </ul>
        <p style="margin-top: 20px; font-style: italic;">
            ${currentLanguage === 'myanmar' ? 
            'ဤ App သည် ဓမ္မအသိများ စတင်ပွားများရန် အထောက်အကူပြုပါစေ။' :
            'May this App help you start your journey to higher Dhamma knowledge.'}
        </p>
    `;
}

// --- Navigation & Page Management ---
function setActiveNav(page) {
    navButtons.forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-page') === page) {
            btn.classList.add('active');
        }
    });
}

// --- Navigation Event Listeners ---
navButtons.forEach(button => {
    button.addEventListener('click', function() {
        const page = this.getAttribute('data-page');
        setActiveNav(page);
        
        if (page === 'home') {
            renderHomePage(dhammaTopics);
        } else if (page === 'categories') {
            renderCategoriesPage();
        } else if (page === 'profile') {
            renderProfilePage();
        }
    });
});


// --- Modal Handlers ---
function showDetailModal(title, text) {
    detailTitle.textContent = title;
    detailText.textContent = text;
    detailModal.style.display = 'block';
}

function closeModal(modalElement) {
    modalElement.style.display = 'none';
}

// Close Modals when the user clicks on (x) or outside the modal
document.querySelectorAll('.close-btn').forEach(btn => {
    btn.addEventListener('click', () => closeModal(btn.closest('.modal')));
});
window.onclick = function(event) {
    if (event.target == detailModal) { closeModal(detailModal); }
    if (event.target == settingsModal) { closeModal(settingsModal); }
    if (event.target == aboutModal) { closeModal(aboutModal); } // New About Modal
}

// --- V2.0: Profile Page Rendering (with Version Info and About Button) ---
function renderProfilePage() {
    mainContent.innerHTML = `
        <div class="profile-card" style="text-align: center; padding: 20px; background: var(--card-bg); border-radius: 12px; margin-top: 20px;">
            <i class="fas fa-user-circle" style="font-size: 4em; color: var(--accent-color);"></i>
            <h3 style="margin: 10px 0;">Dhamma Seeker</h3>
            <p style="color: #666;">${currentLanguage === 'myanmar' ? 'ဓမ္မလေ့လာသူ' : 'Seeker'} (since: 2024)</p>
            
            <p style="font-size: 0.85em; color: var(--primary-color); font-weight: bold; margin: 10px 0;">
                App Version 2.0
            </p>
            
            <div style="display: flex; justify-content: center; gap: 10px; margin-top: 20px;">
                <button id="openSettingsBtn" class="read-btn" style="background-color: var(--primary-color);">
                    <i class="fas fa-cog"></i> ${currentLanguage === 'myanmar' ? 'ချိန်ညှိချက်များ' : 'Settings'}
                </button>
                
                <button id="openAboutBtn" class="read-btn" style="background-color: var(--danger-color);">
                    <i class="fas fa-info-circle"></i> ${currentLanguage === 'myanmar' ? 'App အကြောင်း' : 'About'}
                </button>
            </div>
        </div>
    `;
    
    // Attach Event Listeners to the new buttons
    document.getElementById('openSettingsBtn').addEventListener('click', () => settingsModal.style.display = 'block');
    document.getElementById('openAboutBtn').addEventListener('click', () => aboutModal.style.display = 'block');
}


// --- Settings Component Logic ---

// 1. Dark Mode Toggle
darkModeToggle.addEventListener('change', function() {
    if (this.checked) {
        appFrame.classList.add('dark-mode');
        localStorage.setItem('darkMode', 'enabled');
    } else {
        appFrame.classList.remove('dark-mode');
        localStorage.setItem('darkMode', 'disabled');
    }
});

// 2. Language Change
languageSelect.addEventListener('change', function() {
    currentLanguage = this.value;
    // V2.0: Update About Modal Text when language changes
    document.getElementById('aboutContent').innerHTML = getAboutText(); 
    
    localStorage.setItem('language', currentLanguage);
    
    // Re-render the current page to display new language text
    document.querySelector('.nav-btn.active').click();
});

// 3. Notifications Toggle (Simulated)
// Check if the element exists (since it's an optional setting)
const notificationsToggle = document.getElementById('notificationsToggle');
if (notificationsToggle) {
    notificationsToggle.addEventListener('change', function() {
        const status = this.checked ? 'ON' : 'OFF';
        alert(`Notifications set to ${status}`);
        localStorage.setItem('notifications', status);
    });
}


// 4. Font Style Change
fontStyleSelect.addEventListener('change', function() {
    appFrame.classList.remove('font-serif', 'font-monospace');
    if (this.value === 'serif') {
        appFrame.classList.add('font-serif');
    } else if (this.value === 'monospace') {
        appFrame.classList.add('font-monospace');
    }
    localStorage.setItem('fontStyle', this.value);
});


// --- Final Initialization Call ---
initializeApp();
